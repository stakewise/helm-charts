{{ $root := . }}
{{ $data := dict "Values" .Values "mode" "executionClient" "client" .Values.executionClient }}
{{- range (untilStep 0 (int .Values.replicaCount) 1) }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ include "ethereum.fullname" $root }}-{{ $root.Values.executionClient }}-{{.}}
  labels:
    {{- include "ethereum.labels" $root | nindent 4 }}
    client: execution
    id: {{ . | quote }}
spec:
  type: {{ $root.Values.service.type }}
  ports:
    - port: {{ $root.Values.executionClientRpcPort }}
      targetPort: rpc
      protocol: TCP
      name: rpc
    {{- if $root.Values.metrics.enabled }}
    - port: {{ $root.Values.metrics.port }}
      targetPort: metrics
      protocol: TCP
      name: metrics
    {{- end }}
  selector:
    {{- include "ethereum.selectorLabels" $root | nindent 4 }}
    client: execution
    id: {{ . | quote }}
{{- end }}

{{- range (untilStep 0 (int .Values.replicaCount) 1) }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ include "ethereum.fullname" $root }}-{{ $root.Values.consensusClient }}-{{.}}
  labels:
    {{- include "ethereum.labels" $root | nindent 4 }}
    client: consensus
    id: {{ . | quote }}
spec:
  type: {{ $root.Values.service.type }}
  ports:
    - port: {{ $root.Values.consensusClientRpcPort }}
      targetPort: rpc
      protocol: TCP
      name: rpc
    {{- if $root.Values.metrics.enabled }}
    - port: {{ $root.Values.metrics.port }}
      targetPort: metrics
      protocol: TCP
      name: metrics
    {{- end }}
  selector:
    {{- include "ethereum.selectorLabels" $root | nindent 4 }}
    client: consensus
    id: {{ . | quote }}
{{- end }}
